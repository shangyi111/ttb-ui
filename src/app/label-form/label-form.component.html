<div class="container">
  <h2 class="form-header">ü•É TTB Label Verification App</h2>
  
  <form (ngSubmit)="onSubmit()" class="verification-form">
    
    <div class="form-group">
      <label for="brandName">Brand Name (e.g., Old Tom Distillery):</label>
      <input type="text" id="brandName" [(ngModel)]="brandName" name="brandName" required>
    </div>
    
    <div class="form-group">
      <label for="productClass">Product Class/Type (e.g., Kentucky Straight Bourbon Whiskey):</label>
      <input type="text" id="productClass" [(ngModel)]="productClass" name="productClass" required>
    </div>
    
    <div class="form-group">
      <label for="alcoholContent">Alcohol Content (% ABV):</label>
      <input type="number" id="alcoholContent" [(ngModel)]="alcoholContent" name="alcoholContent" required placeholder="e.g., 45">
    </div>

    <div class="form-group">
      <label for="netContents">Net Contents (Optional/Bonus, e.g., 750 mL or 12 fl oz):</label>
      <input type="text" id="netContents" [(ngModel)]="netContents" name="netContents">
    </div>
    
    <div class="form-group">
      <label for="labelImage">Upload Label Image:</label>
      <input type="file" id="labelImage" (change)="onFileSelected($event)" accept="image/*" required>
    </div>
    
    <button type="submit" [disabled]="!selectedFile || isLoading" class="submit-button">
      Verify Label 
      <span *ngIf="isLoading">...</span>
    </button>
  </form>

  <div *ngIf="isLoading" class="loading-indicator">
    ‚è≥ Processing label with Google Vision API... Please wait.
  </div>

  <hr class="separator">

  <div *ngIf="verificationResults" class="results-container">
    
    <h3 [ngClass]="{'match-success': verificationResults.overall_match, 'match-failure': !verificationResults.overall_match && !verificationResults.error}">
      <span *ngIf="verificationResults.overall_match">‚úÖ MATCH SUCCESSFUL! All required information is consistent.</span>
      <span *ngIf="!verificationResults.overall_match && !verificationResults.error">‚ùå DISCREPANCIES FOUND. Review the details below.</span>
      <span *ngIf="verificationResults.error">‚ö†Ô∏è ERROR: {{ verificationResults.error }}</span>
    </h3>
    
    <div *ngIf="verificationResults.discrepancies">
      <h4 class="table-title">Detailed Check Outcomes:</h4>
      <table class="results-table">
        <thead>
          <tr class="table-header-row">
            <th>Field</th>
            <th>Status</th>
            <th>Expected (Form Input)</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of verificationResults.discrepancies" 
              [ngClass]="{'row-match': item.status.includes('Match'), 'row-mismatch': item.status.includes('Match') === false}">
            <td>{{ item.field }}</td>
            <td class="status-cell">
              {{ item.status.includes('Match') ? '‚úÖ Match' : '‚ùå Mismatch' }}
            </td>
            <td>{{ item.expected }}</td>
            <td>
              <span *ngIf="item.status.includes('Match')">Content successfully found on the label.</span>
              <span *ngIf="item.status !== 'Match'">Text was either not found, or did not match the form input (case-insensitive check).</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <details class="extracted-text-details">
      <summary class="details-summary">View Raw Extracted Text (TTB Agent Review)</summary>
      <p class="extracted-text-content">
        {{ verificationResults.extracted_text }}
      </p>
    </details>
  </div>

  <div *ngIf="responseMessage && !verificationResults" class="error-box">
      <h3 class="error-header">üö® Server/API Error:</h3>
      <pre class="error-pre">{{ responseMessage | json }}</pre>
  </div>
</div>